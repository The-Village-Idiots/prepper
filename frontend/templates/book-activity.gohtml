<!DOCTYPE html>

<html>
	<head>
		{{template "head.gohtml" (println "Booking \"" .Activity.Title "\"")}}

		<script src="/assets/scripts/bookitems.js"></script>
	</head>

	<body>
		{{template "dashnav.gohtml" .}}

		<div class="modal fade text-dark" id="add_item_modal" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">
			<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h6 class="modal-title">Select Item</h6>
					</div>

					<div class="modal-body">
						<table class="table table-striped table-hover table-sm">
							<thead>
								<tr>
									<th scope="col">#</th>
									<th scope="col">Name</th>
									<th scope="col">Available</th>
									<th scope="col"></th>
								</tr>
							</thead>

							<tbody>
								{{range .Equipment}}
									<tr>
										<td>{{.ID}}</td>
										<td>{{.Name}}</td>
										<td>{{.Quantity}}</td>
										<td>
											<button class="btn btn-sm btn-success" onclick='do_add_item({{.ID}}, {{.Name}}, {{.Quantity}})'>
												<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
													<path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
												</svg>
											</button>
										</td>
									</tr>
								{{end}}
							</tbody>
						</table>

						<div class="modal-footer">
							<button class="btn btn-secondary" onclick="cancel_add_item()">Cancel</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<template id="extra_items_template">
			<tr>
				<td id="new_item_id"></td>
				<td id="new_item_name"></td>
				<td>
					<!-- names distinguished using "eqty_" rather than "qty_" -->
					<input class="form-control" name="eqty_ID" value="1" type="number" id="new_item_quantity" min="0" max="1">
				</td>
			</tr>
		</template>

		<div class="container container-fluid mt-3">
			<h1>Items for {{.Activity.Title}}</h1>
			<hr>

			<p>
				You are creating a booking for <strong>{{.Activity.Title}}</strong>.
				Please confirm the quantities of items required for this activity.
				Extra items added via this form will be requested from the prep office but cannot be guaranteed.
			</p>

			<hr>

			<h2>Core Items</h2>

			<form class="mt-4 pb-2" action="/book/{{.Activity.ID}}/timings">
				<table class="table table-striped">
					<thead>
						<tr>
							<th scope="col">#</th>
							<th scope="col">Name</th>
							<th scope="col">Quantity</th>
						</tr>
					</thead>

					<tbody>
						{{range $i, $item := .Activity.Equipment}}
							<tr>
								<td>{{$i}}</td>
								<td>{{$item.Item.Name}}</td>
								<td>
									<input class="form-control" name="qty_{{$item.Item.ID}}" value="{{$item.Quantity}}" type="number" min="1" max="{{$item.Item.Quantity}}">
								</td>
							</tr>
						{{end}}
					</tbody>
				</table>

				<h2>Extra Items</h2>

				<table class="table table-striped" id="extra_items">
					<thead>
						<tr>
							<th scope="col">#</th>
							<th scope="col">Name</th>
							<th scope="col">Quantity</th>
						</tr>
					</thead>

					<tbody id="extra_items_body">
					</tbody>
				</table>

				<a href="#" onclick="add_item(event)">Add Extra Item</a>

				<hr>

				<div class="btn-group">
					<button type="submit" class="btn btn-primary">Next</button>
					<a class="btn btn-secondary" href="/book/">Back</a>
				</div>
			</form>
		</div>
	</body>
</html>
